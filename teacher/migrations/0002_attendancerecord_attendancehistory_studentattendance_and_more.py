# Generated by Django 5.2.5 on 2025-11-15 02:45

import django.core.validators
import django.db.models.deletion
import django.utils.timezone
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ("admin_functionalities", "0012_schoolyear"),
        ("enrollmentprocess", "0003_alter_sectionplacement_selected_program"),
        ("teacher", "0001_initial"),
    ]

    operations = [
        migrations.CreateModel(
            name="AttendanceRecord",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "quarter",
                    models.CharField(
                        choices=[
                            ("Q1", "Quarter 1"),
                            ("Q2", "Quarter 2"),
                            ("Q3", "Quarter 3"),
                            ("Q4", "Quarter 4"),
                        ],
                        max_length=2,
                        verbose_name="Quarter",
                    ),
                ),
                (
                    "month",
                    models.IntegerField(
                        validators=[
                            django.core.validators.MinValueValidator(1),
                            django.core.validators.MaxValueValidator(12),
                        ],
                        verbose_name="Month (1-12)",
                    ),
                ),
                ("year", models.IntegerField(verbose_name="Year")),
                (
                    "school_name",
                    models.CharField(
                        default="Cagayan de Oro National High School",
                        max_length=200,
                        verbose_name="School Name",
                    ),
                ),
                (
                    "school_id",
                    models.CharField(
                        default="304144", max_length=20, verbose_name="School ID"
                    ),
                ),
                (
                    "grade_level",
                    models.CharField(
                        default="Grade 7", max_length=20, verbose_name="Grade Level"
                    ),
                ),
                (
                    "total_days",
                    models.PositiveIntegerField(
                        default=0,
                        help_text="Number of school days (Mon-Fri) in this month",
                        verbose_name="Total School Days in Month",
                    ),
                ),
                (
                    "enrollment_male",
                    models.PositiveIntegerField(
                        default=0, verbose_name="Male Enrollment"
                    ),
                ),
                (
                    "enrollment_female",
                    models.PositiveIntegerField(
                        default=0, verbose_name="Female Enrollment"
                    ),
                ),
                (
                    "late_enrollees_male",
                    models.PositiveIntegerField(
                        default=0, verbose_name="Late Enrollees - Male"
                    ),
                ),
                (
                    "late_enrollees_female",
                    models.PositiveIntegerField(
                        default=0, verbose_name="Late Enrollees - Female"
                    ),
                ),
                (
                    "registered_male",
                    models.PositiveIntegerField(
                        default=0, verbose_name="Registered - Male"
                    ),
                ),
                (
                    "registered_female",
                    models.PositiveIntegerField(
                        default=0, verbose_name="Registered - Female"
                    ),
                ),
                (
                    "avg_attendance_male",
                    models.DecimalField(
                        decimal_places=2,
                        default=0,
                        max_digits=5,
                        verbose_name="Avg Attendance - Male",
                    ),
                ),
                (
                    "avg_attendance_female",
                    models.DecimalField(
                        decimal_places=2,
                        default=0,
                        max_digits=5,
                        verbose_name="Avg Attendance - Female",
                    ),
                ),
                (
                    "attendance_percentage_male",
                    models.DecimalField(
                        decimal_places=2,
                        default=0,
                        max_digits=5,
                        verbose_name="Attendance % - Male",
                    ),
                ),
                (
                    "attendance_percentage_female",
                    models.DecimalField(
                        decimal_places=2,
                        default=0,
                        max_digits=5,
                        verbose_name="Attendance % - Female",
                    ),
                ),
                (
                    "dropped_male",
                    models.PositiveIntegerField(
                        default=0, verbose_name="Dropped - Male"
                    ),
                ),
                (
                    "dropped_female",
                    models.PositiveIntegerField(
                        default=0, verbose_name="Dropped - Female"
                    ),
                ),
                (
                    "transferred_out_male",
                    models.PositiveIntegerField(
                        default=0, verbose_name="Transferred Out - Male"
                    ),
                ),
                (
                    "transferred_out_female",
                    models.PositiveIntegerField(
                        default=0, verbose_name="Transferred Out - Female"
                    ),
                ),
                (
                    "transferred_in_male",
                    models.PositiveIntegerField(
                        default=0, verbose_name="Transferred In - Male"
                    ),
                ),
                (
                    "transferred_in_female",
                    models.PositiveIntegerField(
                        default=0, verbose_name="Transferred In - Female"
                    ),
                ),
                (
                    "adviser_name",
                    models.CharField(
                        blank=True, max_length=150, verbose_name="Adviser Name"
                    ),
                ),
                (
                    "principal_name",
                    models.CharField(
                        blank=True,
                        max_length=150,
                        verbose_name="Principal/School Head Name",
                    ),
                ),
                (
                    "is_finalized",
                    models.BooleanField(
                        default=False,
                        help_text="Mark as finalized to prevent further edits",
                        verbose_name="Is Finalized",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "school_year",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="attendance_records",
                        to="admin_functionalities.schoolyear",
                        verbose_name="School Year",
                    ),
                ),
                (
                    "section",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="attendance_records",
                        to="admin_functionalities.section",
                        verbose_name="Section",
                    ),
                ),
                (
                    "teacher",
                    models.ForeignKey(
                        help_text="Teacher who manages this attendance record",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="attendance_records",
                        to="admin_functionalities.teacher",
                        verbose_name="Teacher (Adviser)",
                    ),
                ),
            ],
            options={
                "verbose_name": "Attendance Record",
                "verbose_name_plural": "Attendance Records",
                "ordering": ["-year", "-month", "section"],
            },
        ),
        migrations.CreateModel(
            name="AttendanceHistory",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "action",
                    models.CharField(
                        choices=[
                            ("created", "Created"),
                            ("updated", "Updated"),
                            ("finalized", "Finalized"),
                            ("exported", "Exported to Excel"),
                        ],
                        max_length=50,
                        verbose_name="Action",
                    ),
                ),
                (
                    "snapshot_data",
                    models.JSONField(
                        default=dict,
                        help_text="JSON snapshot of key metrics",
                        verbose_name="Data Snapshot",
                    ),
                ),
                (
                    "timestamp",
                    models.DateTimeField(
                        default=django.utils.timezone.now, verbose_name="Timestamp"
                    ),
                ),
                ("notes", models.TextField(blank=True, verbose_name="Notes")),
                (
                    "modified_by",
                    models.ForeignKey(
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="attendance_history",
                        to="admin_functionalities.teacher",
                        verbose_name="Modified By",
                    ),
                ),
                (
                    "attendance_record",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="history_logs",
                        to="teacher.attendancerecord",
                        verbose_name="Attendance Record",
                    ),
                ),
            ],
            options={
                "verbose_name": "Attendance History",
                "verbose_name_plural": "Attendance Histories",
                "ordering": ["-timestamp"],
            },
        ),
        migrations.CreateModel(
            name="StudentAttendance",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "daily_attendance",
                    models.JSONField(
                        default=list,
                        help_text="Array of attendance codes for each school day",
                        verbose_name="Daily Attendance Codes",
                    ),
                ),
                (
                    "total_absences",
                    models.PositiveIntegerField(
                        default=0, verbose_name="Total Absences"
                    ),
                ),
                (
                    "total_tardies",
                    models.PositiveIntegerField(
                        default=0, verbose_name="Total Tardies"
                    ),
                ),
                (
                    "total_present",
                    models.PositiveIntegerField(
                        default=0, verbose_name="Total Present Days"
                    ),
                ),
                (
                    "remarks",
                    models.TextField(
                        blank=True,
                        help_text="Note reasons for absences, dropout, transfer, etc.",
                        verbose_name="Remarks",
                    ),
                ),
                (
                    "is_at_risk",
                    models.BooleanField(
                        default=False,
                        help_text="Student has 5-6 absences",
                        verbose_name="At Risk of Dropout",
                    ),
                ),
                (
                    "is_dropout",
                    models.BooleanField(
                        default=False,
                        help_text="Student has 7+ absences",
                        verbose_name="Subject to Dropout",
                    ),
                ),
                (
                    "has_valid_excuse",
                    models.BooleanField(
                        default=False,
                        help_text="Teacher marked absences as excused",
                        verbose_name="Has Valid Excuse",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "attendance_record",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="student_attendance",
                        to="teacher.attendancerecord",
                        verbose_name="Attendance Record",
                    ),
                ),
                (
                    "student",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="monthly_attendance",
                        to="enrollmentprocess.student",
                        verbose_name="Student",
                    ),
                ),
            ],
            options={
                "verbose_name": "Student Attendance",
                "verbose_name_plural": "Student Attendance Records",
                "ordering": ["student__last_name", "student__first_name"],
            },
        ),
        migrations.AddIndex(
            model_name="attendancerecord",
            index=models.Index(
                fields=["section", "school_year", "quarter"],
                name="teacher_att_section_a93ad4_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="attendancerecord",
            index=models.Index(
                fields=["teacher", "year", "month"],
                name="teacher_att_teacher_d13311_idx",
            ),
        ),
        migrations.AlterUniqueTogether(
            name="attendancerecord",
            unique_together={("section", "school_year", "quarter", "month", "year")},
        ),
        migrations.AddIndex(
            model_name="attendancehistory",
            index=models.Index(
                fields=["attendance_record", "-timestamp"],
                name="teacher_att_attenda_209913_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="studentattendance",
            index=models.Index(
                fields=["attendance_record", "student"],
                name="teacher_stu_attenda_fcde43_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="studentattendance",
            index=models.Index(
                fields=["total_absences"], name="teacher_stu_total_a_911a14_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="studentattendance",
            index=models.Index(
                fields=["is_at_risk"], name="teacher_stu_is_at_r_af312b_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="studentattendance",
            index=models.Index(
                fields=["is_dropout"], name="teacher_stu_is_drop_02cff9_idx"
            ),
        ),
        migrations.AlterUniqueTogether(
            name="studentattendance",
            unique_together={("attendance_record", "student")},
        ),
    ]
